<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kimp SpaceJoy</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div id="app">
    <header class="top-bar">
      <div class="toggles">
        <button id="leave-game" class="toggle leave-btn" style="display: none;">Leave Game</button>
        <button id="mute-toggle" class="toggle">Mute</button>
        <button id="graphics-toggle" class="toggle">Pixelated Mode: Off</button>
        <div id="connection-indicator" class="connection-indicator" style="display: none;">
          <span class="connection-dot"></span>
          <span class="connection-text">Connection</span>
        </div>
      </div>
      <div id="room-timer" class="room-timer" style="display: none;">
        <span id="timer-display" class="timer-display">--:--</span>
      </div>
      <img src="/assets/spacejoy-text.webp" alt="SpaceJoy" class="topbar-spacejoy" />
    </header>

    <main>
      <div id="toast-container" class="toast-container"></div>
      <section id="splash-screen" class="screen active">
        <div class="splash-container">
          <div class="splash-image">
            <img src="/assets/asset 24.webp" alt="Animated splash" />
          </div>
          <div class="splash-content">
            <div class="logo">
              <svg xmlns="http://www.w3.org/2000/svg" width="98" height="40" viewBox="0 0 98 40" fill="none"><g clip-path="url(#clip0_3_9)"><path d="M65.1322 0.144897H65.2033L65.1322 0.217498V0.144897Z" fill="white"/><path d="M13.2831 18.5858L25.0011 0H18.2871L7.43635 16.9886H6.0254V0.145202H0V30.565H6.0254V23.0145H9.30135C17.5597 39.0071 39.6981 45.4925 53.8291 34.6241C52.9109 33.0131 51.7589 30.9941 50.8035 29.3184C38.3761 39.3004 20.3199 32.7292 13.2831 18.5858Z" fill="white"/><path d="M96.9717 17.5545C97.58 16.0437 98.014 14.628 97.9996 12.8115C97.9645 8.27401 95.9553 4.41889 91.9176 2.32363C89.8861 1.31728 87.6946 0.682882 85.4446 0.449798C84.6692 0.353965 73.883 0.0200003 73.883 0.308952V30.492H79.9084V23.4381C79.9084 23.5543 85.7258 23.4381 86.3039 23.4309C94.0573 23.3909 96.9717 17.5545 96.9717 17.5545ZM90.0942 16.5381C87.4997 18.7241 79.9084 18.0947 79.9084 18.0947V5.7925C88.6151 5.7925 91.2785 7.78177 91.9491 11.3522C92.32 13.3299 91.4083 15.7083 90.0942 16.5396V16.5381Z" fill="white"/><path d="M62.1105 6.2436H62.0466V6.30531L55.3125 13.1088L54.8671 13.5575C51.1199 9.77128 45.2415 3.83252 41.5316 0.0870361V8.71203L41.5172 8.69751C41.5388 11.1086 41.5388 20.5373 41.5337 29.171C43.6755 28.5725 45.7094 27.6326 47.5591 26.3868V14.8011C48.7635 16.0157 51.0496 18.3244 52.2776 19.5645L54.8735 22.1839C56.7636 20.2759 60.1551 16.8514 62.0466 14.9369V30.565H68.072V0.224252L62.1105 6.2436Z" fill="white"/><path d="M36.3675 29.9113V0.144897H30.342V29.1562C32.1805 29.6594 34.0764 29.9155 35.9808 29.9178C36.1107 29.9178 36.2376 29.9113 36.3675 29.9113Z" fill="white"/></g><defs><clipPath id="clip0_3_9"><rect width="98" height="40" fill="white"/></clipPath></defs></svg>
            </div>
            <img src="/assets/spacejoy-text.webp" alt="Kimp SpaceJoy" class="spacejoy-title" />
            <p>Fast-paced co-op adventuring for up to 15 players.</p>
            <div class="actions">
              <button id="splash-create">Create Game</button>
              <button id="splash-join">Join Game</button>
            </div>
          </div>
        </div>
      </section>

      <section id="create-screen" class="screen">
        <h2>Create a Game</h2>
        <form id="create-form">
          <label>Display Name
            <input type="text" id="create-name" maxlength="16" required />
          </label>
          <label>Choose Your Spaceship <span style="color: #EF4444;">*</span>
            <div id="create-spaceship-grid" class="spaceship-grid"></div>
            <input type="hidden" id="create-spaceship" required />
          </label>
          <div class="form-row">
            <label>Target Score
              <input type="number" id="create-target" value="50" min="10" max="500" />
            </label>
            <label>Max Players
              <input type="number" id="create-max" value="15" min="2" max="15" />
            </label>
            <label>Room timeout (minutes)
              <input type="number" id="create-timeout" value="10" min="2" max="60" />
            </label>
          </div>
          <div class="form-row-3col">
            <label>Room Passcode
              <input type="text" id="create-passcode" maxlength="32" placeholder="Optional" />
            </label>
            <label class="switch">
              <input type="checkbox" id="create-passcode-enabled" checked />
              <span>Passcode</span>
            </label>
            <label class="switch">
              <input type="checkbox" id="create-death-penalty" checked />
              <span>Death penalty</span>
            </label>
          </div>
          <div class="form-actions">
            <button type="submit">Create</button>
            <button type="button" data-nav="splash">Back</button>
          </div>
        </form>
      </section>

      <section id="join-screen" class="screen">
        <h2>Join a Game</h2>
        <p class="info-text">You can join games in lobby or already in progress!</p>
        <form id="join-form">
          <div class="form-row-2col">
            <label>Join URL or Room ID
              <input type="text" id="join-link" required />
            </label>
            <label>Display Name
              <input type="text" id="join-name" maxlength="16" required />
            </label>
          </div>
          <label>Choose Your Spaceship <span style="color: #EF4444;">*</span>
            <div id="join-spaceship-grid" class="spaceship-grid"></div>
            <input type="hidden" id="join-spaceship" required />
          </label>
          <label>Passcode
            <input type="text" id="join-passcode" maxlength="32" placeholder="Optional" />
          </label>
          <div class="form-actions">
            <button type="submit">Join</button>
            <button type="button" data-nav="splash">Back</button>
          </div>
        </form>
      </section>

      <section id="lobby-screen" class="screen">
        <h2>Lobby</h2>
        <div class="room-info">
          <div id="room-id"></div>
          <div id="room-config"></div>
        </div>
        <p class="info-text">Players can join even after the match starts. Share the link anytime!</p>
        <div class="lobby-controls">
          <button id="copy-link">Copy Link</button>
          <button id="start-game" class="primary">Start Game</button>
        </div>
        <ul id="player-list"></ul>
      </section>

      <section id="game-screen" class="screen">
        <div class="hud">
          <div class="progress-bar">
            <div class="label">Progress to victory</div>
            <div class="bar">
              <div id="progress-fill"></div>
            </div>
            <div class="score-display">
              <span id="current-score">0</span> / <span id="target-score">50</span>
            </div>
          </div>
          <div class="game-tips">
            <div class="tip-label">Tips</div>
            <div id="tip-text" class="tip-text"></div>
          </div>
          <div class="collectables-info">
            <div class="tip-label">Special Collectables (Press SPACE to obtain them)</div>
            <div class="collectable-items">
              <div class="collectable-item">
                <svg class="collectable-icon powerup-icon" width="20" height="20" viewBox="0 0 20 20">
                  <!-- Outer glow -->
                  <circle cx="10" cy="10" r="9" fill="rgba(168, 85, 247, 0.3)"/>
                  <!-- 8-pointed star shape -->
                  <path d="M 10 2 L 11.5 8.5 L 18 10 L 11.5 11.5 L 10 18 L 8.5 11.5 L 2 10 L 8.5 8.5 Z" 
                        fill="#A855F7" stroke="#7C3AED" stroke-width="1.5"/>
                  <!-- Inner core -->
                  <circle cx="10" cy="10" r="3.5" fill="#C084FC"/>
                  <!-- Bright center highlight -->
                  <circle cx="9.2" cy="9.2" r="1.5" fill="#E9D5FF"/>
                </svg>
                <span class="collectable-text">Mega Blast - Only destroys nearby teammates (Press SPACE to Kill)</span>
              </div>
              <div class="collectable-item">
                <svg class="collectable-icon rapidfire-icon" width="20" height="20" viewBox="0 0 20 20">
                  <!-- Outer glow -->
                  <circle cx="10" cy="10" r="9.5" fill="rgba(251, 146, 60, 0.4)"/>
                  <!-- Three arrows pointing outward -->
                  <g transform="translate(10, 10)">
                    <!-- Arrow 1 (top) -->
                    <path d="M 0 -2 L 3 -2 L 5 0 L 3 2 L 0 2 Z" fill="#FB923C"/>
                    <!-- Arrow 2 (bottom-left) -->
                    <path d="M -1.7 1 L -4 0.5 L -4.3 -2.5 L -2.6 -1 L -1 -1.7 Z" fill="#FB923C"/>
                    <!-- Arrow 3 (bottom-right) -->
                    <path d="M 1.7 1 L 4 0.5 L 4.3 -2.5 L 2.6 -1 L 1 -1.7 Z" fill="#FB923C"/>
                    <!-- Center circle -->
                    <circle cx="0" cy="0" r="2.8" fill="#F97316" stroke="#EA580C" stroke-width="1.5"/>
                  </g>
                </svg>
                <span class="collectable-text">Rapid Fire - Fast shooting for 3 sec</span>
              </div>
            </div>
          </div>
        </div>
        <div class="canvas-wrapper">
          <canvas id="game-canvas" width="960" height="540"></canvas>
          <div id="effect-layer" aria-hidden="true"></div>
        </div>
        <div class="scoreboard">
          <h3>Scores</h3>
          <ul id="score-list"></ul>
        </div>
        <div id="mobile-controls">
          <div id="joystick">
            <div id="joystick-handle"></div>
          </div>
          <button id="action-button">Dash</button>
        </div>
      </section>

      <section id="results-screen" class="screen">
        <h2>Match Results</h2>
        <div id="winner-announcement"></div>
        <ul id="results-list"></ul>
        <div class="results-actions">
          <button id="rematch">Play Again</button>
          <button id="results-copy-link">Copy Link</button>
        </div>
      </section>
    </main>

    <footer>
      <small>&copy; 2025 Kimp SpaceJoy</small>
    </footer>
  </div>

  <script type="module" src="/app.js"></script>
</body>
</html>
